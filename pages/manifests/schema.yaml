$schema: "http://json-schema.org/draft-07/schema#"
title: Kraken Module Manifest
type: object
required:
  - id
  - version
  - type
  - build
  - runtime
  - findings

properties:
  id:
    type: string
    pattern: "^[a-z][a-z0-9_]*$"
    description: Module identifier (lowercase, underscores)

  version:
    type: string
    pattern: "^[0-9]+\\.[0-9]+\\.[0-9]+$"
    description: Semantic version

  type:
    type: string
    enum: [abi, container, grpc]

  description:
    type: string
    maxLength: 256

  build:
    type: object
    required: [system]
    properties:
      system:
        type: string
        enum: [cargo, cmake, docker, go]
      platforms:
        type: array
        items:
          type: string
          enum: [linux-amd64, linux-arm64]
        default: [linux-amd64]

  abi:
    type: object
    description: Required for type=abi
    properties:
      api:
        type: string
        enum: [v2]
      symbol:
        type: string
        default: kraken_run_v2

  container:
    type: object
    description: Required for type=container
    properties:
      dockerfile:
        type: string
        default: Dockerfile

  grpc:
    type: object
    description: Required for type=grpc
    properties:
      service:
        type: string
      default_port:
        type: integer

  runtime:
    type: object
    required: [protocol]
    properties:
      protocol:
        type: string
        description: Target protocol (mqtt, modbus, ethercat, tls, etc.)
      timeout:
        type: string
        pattern: "^[0-9]+(s|m)$"
        default: "30s"
      memory:
        type: string
        pattern: "^[0-9]+(m|g)$"
        default: "256m"

  params:
    type: object
    description: JSON Schema for module parameters
    properties:
      type:
        const: object
      properties:
        type: object
      required:
        type: array
        items:
          type: string

  findings:
    type: array
    minItems: 1
    items:
      type: object
      required: [id, severity, description]
      properties:
        id:
          type: string
          pattern: "^[A-Z][A-Z0-9_-]*$"
        severity:
          type: string
          enum: [critical, high, medium, low, info]
        description:
          type: string
